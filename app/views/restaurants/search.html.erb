<% if @error %>
  <div class="alert alert-danger" role="alert">
    <p><%= @error %></p>
  </div>
<% end %>
<h1>検索</h1>

<%= form_with url: restaurants_index_path, method: :get, local: true do |f| %>
  <div class="form-group">
    <%= f.text_field :freeword, placeholder: "キーワードを入力　例）ラーメン　居酒屋", class: "form-control" %>
  </div>
  <div class="search">
    <p>検索範囲を選択してください。<%= f.select(:range, options_for_select([["300m","1"], ["500m", "2"], ["1000m","3"]], :selected => "2"), class: "select") %></p>
  </div>
  <div class="form-group text-right">
    <%= f.submit '検索する', class: "btn btn-outline-primary" %>
  </div>
<% end %>

<script>

  if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function(position) {

          let lat = position.coords.latitude;
          let lng = position.coords.longitude;

          $(".search").append(
            `<input type="hidden" id="id" name="lat" value="${lat}">
            <input type="hidden" id="id" name="lng" value="${lng}">`
          );

          $(".select").change(function() {
            let num = $(this).val();
            let radius = 500;
            if (num == "1") {
              radius = 300;
            } else if (num == "2") {
              radius = 500;
            } else if (num == "3") {
              radius = 1000;
            }
          });
        },
        function(error) {
          let errorMessage = [
            "原因不明のエラーが発生しました。",
            "位置情報の取得が許可されませんでした。",
            "デバイスの位置が判定できませんでした。",
            "タイムアウトして位置情報を取得できませんでした。"
           ] ;

          alert( errorMessage[error.code] );
        },
  
        {
          enableHighAccuracy: false,
          timeout: 20000,
          maximumAge: 2000
        }
      );
  } else {
    let errorMessage = "お使いの端末は、GeoLacation APIに対応していません。";
    alert(errorMessage);
  }

</script>
